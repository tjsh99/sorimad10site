<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>코멘트 - 2024</title>
    <link rel="stylesheet" href="style.css">

    <style>
        /* 기존 코드 스타일 정리 */
        #legacy-code-area {
            width: 100%;
            /* 가로 꽉 채우기 */
            text-align: left;
            /* 내부 텍스트 왼쪽 정렬 */
        }

        .comment-group {
            margin-bottom: 40px;
            /* 그룹 간 간격 넉넉하게 */
            border: 1px solid #eee;
            /* 전체 박스 테두리 */
            border-radius: 12px;
            overflow: hidden;
            /* 둥근 모서리 안 튀어나오게 */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            /* 살짝 그림자 */
        }

        .video-header {
            background-color: #333;
            /* 헤더 배경색 */
            color: #fff;
            padding: 15px 20px;
            font-size: 1.1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .video-header:hover {
            background-color: #444;
            /* 마우스 올리면 살짝 밝게 */
        }

        .video-thumbnail {
            width: 80px;
            height: 45px;
            border-radius: 4px;
            object-fit: cover;
            flex-shrink: 0;
            /* 썸네일 찌그러짐 방지 */
            background-color: black;
        }

        .comment-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
        }

        .comment-table th,
        .comment-table td {
            padding: 12px 15px;
            /* 여백 넉넉하게 */
            text-align: left;
            border-bottom: 1px solid #eee;
            line-height: 1.5;
        }

        .comment-table th {
            background-color: #f5f5f5;
            font-weight: bold;
            color: #555;
            border-bottom: 2px solid #ddd;
            /* 헤더 구분선 조금 진하게 */
        }

        /* 첫 번째 칸 (투표자 이름) 너비 및 스타일 */
        .comment-table td:first-child {
            width: 20%;
            min-width: 100px;
            /* 너무 좁아지지 않게 */
            font-weight: bold;
            color: #333;
            vertical-align: top;
            /* 이름이 길어도 위쪽에 붙게 */
        }

        /* 두 번째 칸 (코멘트) 색상 */
        .comment-table td:last-child {
            color: #555;
        }

        /* 마지막 줄은 밑줄 없애기 (깔끔하게) */
        .comment-table tr:last-child td {
            border-bottom: none;
        }
    </style>
</head>

<body>

    <div class="container">
        <header>
            <h1 class="main-title">
                <a href="index.html">소리MAD 대상</a>
            </h1>

            <nav class="gnb">
                <ul>
                    <li><a href="result_2025.html" class="active">소리MAD 10선</a></li>
                    <li><a href="awards_2025.html">소리MAD 어워즈</a></li>
                    <li><a href="vote.html">투표하기</a></li>
                    <li><a href="article.html">10선 기사 읽기</a></li>
                </ul>
            </nav>
        </header>

        <nav class="sub-gnb">
            <ul>
                <li><a href="result_2025.html">10선 결과</a></li>
                <li><a href="everyone_2025.html">모두의 10선</a></li>
                <li><a href="comment_2025.html" class="sub-active">코멘트</a></li>
            </ul>
        </nav>

        <main class="content-area">

            <div class="year-selector">
                <a href="comment_2025.html" class="year-btn">2025</a>
                <a href="comment_2024.html" class="year-btn year-active">2024</a>
            </div>

            <div id="legacy-code-area">
                <div id="container"></div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const sheetId = '1DZET9hl7eVakqGtGuztbGfE6cjWtO0r5Nm3QA_XFjEg';
            const sheetName = '2024';
            const baseUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?`;
            const query = encodeURIComponent(`Select B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z, AA, AB, AC, AD, AE, AF`);
            const url = `${baseUrl}&sheet=${sheetName}&tq=${query}`;

            fetch(url)
                .then(res => res.text())
                .then(rep => {
                    const data = JSON.parse(rep.substr(47).slice(0, -2));
                    const container = document.getElementById('container');

                    const videoComments = {};

                    data.table.rows.forEach((row, index) => {
                        if (index === 0) return;

                        const bValue = row.c[0]?.v;
                        for (let i = 1; i < row.c.length; i += 3) {
                            const videoId = row.c[i]?.v;
                            const videoTitle = row.c[i + 1]?.v;
                            const videoComment = row.c[i + 2]?.v;

                            if (videoId && videoTitle) {
                                if (!videoComments[videoId]) {
                                    videoComments[videoId] = {
                                        title: videoTitle,
                                        thumbnail: `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`,
                                        comments: []
                                    };
                                }
                                if (videoComment) {
                                    videoComments[videoId].comments.push({ bValue, comment: videoComment });
                                } else {
                                    // 빈 코멘트도 일단 데이터에는 있지만, 나중에 출력할지 말지는 선택 가능
                                    videoComments[videoId].comments.push({ bValue, comment: '' });
                                }
                            }
                        }
                    });

                    // 정렬: 코멘트 많은 순 -> 제목 가나다순
                    const sortedVideos = Object.entries(videoComments).sort((a, b) => {
                        const commentCountA = a[1].comments.length;
                        const commentCountB = b[1].comments.length;
                        if (commentCountA > commentCountB) return -1;
                        if (commentCountA < commentCountB) return 1;
                        return a[1].title.localeCompare(b[1].title);
                    });

                    sortedVideos.forEach(([videoId, { title, thumbnail, comments }]) => {
                        // 코멘트 알파벳순 정렬
                        comments.sort((a, b) => a.comment.localeCompare(b.comment));

                        // 만약 '코멘트가 있는 영상만' 보여주고 싶으면 아래 if문 주석 해제
                        // if (comments.every(c => c.comment === '')) return;

                        const group = document.createElement('div');
                        group.className = 'comment-group';

                        // 헤더 (썸네일 + 제목)
                        const header = document.createElement('div');
                        header.className = 'video-header';
                        const thumbnailImg = document.createElement('img');
                        thumbnailImg.src = thumbnail;
                        thumbnailImg.className = 'video-thumbnail';
                        const titleText = document.createElement('div');
                        titleText.textContent = title;
                        header.appendChild(thumbnailImg);
                        header.appendChild(titleText);

                        header.onclick = () => window.open(`https://youtu.be/${videoId}`, '_blank');

                        group.appendChild(header);

                        // 표 생성
                        const table = document.createElement('table');
                        table.className = 'comment-table';

                        const tableHeader = document.createElement('thead');
                        const headerRow = document.createElement('tr');
                        const headerCell1 = document.createElement('th');
                        headerCell1.textContent = '투표자';
                        const headerCell2 = document.createElement('th');
                        headerCell2.textContent = '코멘트';
                        headerRow.appendChild(headerCell1);
                        headerRow.appendChild(headerCell2);
                        tableHeader.appendChild(headerRow);
                        table.appendChild(tableHeader);

                        const tableBody = document.createElement('tbody');

                        // 코멘트가 없는 행은 출력 안 하고 싶으면 여기서 필터링 가능
                        comments.forEach(({ bValue, comment }) => {
                            // 예: if (comment === '') return;

                            const row = document.createElement('tr');
                            const cell1 = document.createElement('td');
                            cell1.textContent = bValue || '-'; // 이름 없으면 - 표시
                            const cell2 = document.createElement('td');
                            cell2.textContent = comment || '';
                            row.appendChild(cell1);
                            row.appendChild(cell2);
                            tableBody.appendChild(row);
                        });
                        table.appendChild(tableBody);

                        group.appendChild(table);
                        container.appendChild(group);
                    });
                });
        });
    </script>
</body>

</html>